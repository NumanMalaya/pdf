<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PPT Format Multi-Category Exporter</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pptxgenjs/3.12.0/pptxgen.bundle.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f0f0f0;
  margin: 0;
  padding: 20px;
  text-align: center;
}
h1 { margin-bottom: 10px; }
.top-bar { margin-bottom: 20px; }
.top-bar button {
  padding: 10px 20px;
  font-size: 16px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background: #004080;
  color: white;
  margin: 5px;
}
.top-bar button:hover { background: #0066cc; }
.category-box {
  border: 2px solid #ccc;
  padding: 15px;
  margin: 15px auto;
  width: 850px;
  background: #fff;
  border-radius: 8px;
}
.category-box input[type=text] {
  padding: 8px;
  font-size: 16px;
  margin-bottom: 10px;
  width: 60%;
}
.slide {
  width: 800px;
  height: 500px;
  margin: 20px auto;
  background: white;
  border: 2px solid #333;
  position: relative;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}
.logos { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; position: relative; }
.logos img.small { height: 80px; width: auto; margin-top: 15px;}
.logos img.center { position: absolute; left: 50%; top: 5px; transform: translateX(-50%); height: 120px; width: auto; }
.category { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 50px; font-weight: 800; margin-bottom: 20px; }
.images { flex: 1; display: flex; justify-content: space-around; margin-top: 20px; align-items: center; padding: 10px; gap: 10px; }
.images img { width: 350px; height: 300px; border: 1px solid #ccc; border-radius: 4px; object-fit: cover; }
.footer { text-align: center; font-weight: 800; padding: 10px; font-size: 22px; color: #051c71; }

/* Advanced Neon Spinner Overlay */
#progressOverlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.85);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

/* Neon Spinner */
#progressCircleContainer {
  position: relative;
  width: 120px;
  height: 120px;
}

.neon-ring {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  border: 8px solid transparent;
  border-top-color: #00f0ff;
  border-radius: 50%;
  animation: spin 1.2s linear infinite;
}

.neon-ring:nth-child(2) {
  border-top-color: #ff00f0;
  animation-duration: 1.6s;
}

.neon-ring:nth-child(3) {
  border-top-color: #00ff88;
  animation-duration: 2s;
  }

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Progress Text Styling */
#progressText {
  margin-top: 25px;
  font-weight: bold;
  font-size: 20px;
  color: #0ff;
  text-align: center;
  text-shadow: 0 0 8px #0ff, 0 0 16px #0ff;
}
#progressText span { margin: 3px 0; }
</style>
</head>
<body>
<h1>Malaya - Multi-Category PPT Generator</h1>

<div class="top-bar">
  <button onclick="addCategory()">+ Add Category</button>
  <button onclick="downloadPDF()">Download PDF</button>
</div>

<div id="categoriesContainer"></div>
<div id="slidesContainer"></div>

<!-- Futuristic Neon Spinner Overlay -->
<div id="progressOverlay" class="flex">
  <div id="progressCircleContainer">
    <div class="neon-ring"></div>
    <div class="neon-ring"></div>
    <div class="neon-ring"></div>
  </div>
  <div id="progressText">
    <span id="percentage">0%</span>
    <span id="slideCount">0 / 0 slides</span>
  </div>
</div>

<script>
let categories = [];
const leftLogo = "data/iconLeft.png";
const centerLogo = "data/iconCenter.png";
const rightLogo = "data/iconRight.png";

function addCategory() {
  const index = categories.length;
  categories.push({ name: "", images: [] });
  const container = document.getElementById("categoriesContainer");
  const box = document.createElement("div");
  box.className = "category-box";
  box.innerHTML = `
    <h3>Category ${index+1}</h3>
    <input type="text" placeholder="Enter category name" oninput="updateCategoryName(${index}, this.value)">
    <br>
    <input type="file" multiple accept="image/*" onchange="updateCategoryImages(${index}, this.files)">
  `;
  container.appendChild(box);
}

function updateCategoryName(index, value) { categories[index].name = value; renderSlides(); }
function updateCategoryImages(index, files) { categories[index].images = Array.from(files).map(f => URL.createObjectURL(f)); renderSlides(); }

function renderSlides() {
  const container = document.getElementById("slidesContainer");
  container.innerHTML = "";
  let slideCount = 0;
  categories.forEach(cat => {
    if(!cat.name && cat.images.length===0) return;
    const firstSlide = document.createElement("div");
    firstSlide.className="slide";
    firstSlide.id="slide-"+slideCount;
    firstSlide.innerHTML=`
      <div class="logos">
        <img src="${leftLogo}" class="small">
        <img src="${centerLogo}" class="center">
        <img src="${rightLogo}" class="small">
      </div>
      <div class="category">${cat.name||"Category"}</div>
      <div class="footer">HS & CO Pvt Ltd</div>
    `;
    container.appendChild(firstSlide); slideCount++;
    for(let i=0;i<cat.images.length;i+=2){
      const slide=document.createElement("div");
      slide.className="slide"; slide.id="slide-"+slideCount;
      let img1 = cat.images[i]?`<img src="${cat.images[i]}">`:"";
      let img2 = cat.images[i+1]?`<img src="${cat.images[i+1]}">`:"";
      slide.innerHTML=`
        <div class="logos">
          <img src="${leftLogo}" class="small">
          <img src="${centerLogo}" class="center">
          <img src="${rightLogo}" class="small">
        </div>
        <div class="images">${img1}${img2}</div>
        <div class="footer">HS & CO Pvt Ltd</div>
      `;
      container.appendChild(slide); slideCount++;
    }
  });
}

async function downloadPDF(){
  if(categories.length===0) return alert("Add at least one category!");
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("landscape","pt","a4");

  const overlay=document.getElementById("progressOverlay");
  const percentageText=document.getElementById("percentage");
  const slideCountText=document.getElementById("slideCount");
  overlay.style.display="flex";

  const totalSlides = categories.reduce((acc,cat)=>{
    if(!cat.name && cat.images.length===0) return acc;
    return acc + 1 + Math.ceil(cat.images.length/2);
  },0);

  let slideIndex=0;
  function updateProgress(index){
    const percent=Math.round((index/totalSlides)*100);
    percentageText.innerText=percent+"%";
    slideCountText.innerText=index+" / "+totalSlides+" slides";
  }

  for(let c=0;c<categories.length;c++){
    const cat=categories[c];
    if(!cat.name && cat.images.length===0) continue;
    const catSlide=await html2canvas(document.getElementById("slide-"+slideIndex));
    pdf.addImage(catSlide.toDataURL("image/png"),"PNG",20,50,800,500);
    slideIndex++; updateProgress(slideIndex);
    for(let i=0;i<cat.images.length;i+=2){
      if(slideIndex>0) pdf.addPage();
      const canvas=await html2canvas(document.getElementById("slide-"+slideIndex));
      pdf.addImage(canvas.toDataURL("image/png"),"PNG",20,50,800,500);
      slideIndex++; updateProgress(slideIndex);
    }
    if(c<categories.length-1) pdf.addPage();
  }

  overlay.style.display="none";
  pdf.save("HS_CO_Presentation.pdf");
}
</script>
</body>
</html>
